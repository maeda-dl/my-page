<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>社員紹介＋おみくじ</title>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
<style>
html, body {
  margin:0; padding:0; height:100%;
  font-family:'Playfair Display', serif;
  font-weight:700;
  background:#ffffff;
  overflow:hidden;
  transition: background 1s ease;
  -webkit-user-select:none;
  -ms-user-select:none;
  user-select:none;
}
#particles { position:fixed; top:0; left:0; width:100%; height:100%; z-index:1; }
.container { position:relative; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; height:100%; padding:1em; z-index:2; perspective:500px; }
.message, #name { opacity:0; margin:0.5em 0; font-weight:bold; transition:opacity 1s ease, transform 0.1s ease; text-align:center; }
#msg1 { font-size:calc(20px + 2vw); }
#dataLine { font-size:calc(22px + 2vw); font-family:'Pacifico', cursive; display:inline-block; font-weight:bold; letter-spacing:2px; perspective:500px; }
#dataLine span { color:navy; display:inline-block; animation: shimmer 1.5s linear infinite; text-shadow:1px 1px 0 #222, 2px 2px 3px rgba(0,0,0,0.6), -1px -1px 1px rgba(255,255,255,0.2); }
@keyframes shimmer { 0%,80%,100% { color:navy; text-shadow:1px 1px 0 #222,2px 2px 3px rgba(0,0,0,0.6),-1px -1px 1px rgba(255,255,255,0.2);} 40% { color:silver; text-shadow:0 0 8px rgba(192,192,192,0.8),1px 1px 0 #222,2px 2px 5px rgba(0,0,0,0.6);} }
#name { font-size:calc(22px + 2vw); }
.image-wrapper { margin-top:1em; position:relative; width:90%; max-width:400px; }
.image { display:block; width:100%; height:auto; position:absolute; top:0; left:0; opacity:0; transition:opacity 0.8s ease; border-radius:10px; }
#omikujiBtn {
  position: fixed; bottom: 20%; left: 50%; transform: translate(-50%,0);
  min-width: 220px; padding: 12px 25px; font-size: 22px; font-weight: bold;
  border: none; border-radius: 50px;
  background: linear-gradient(145deg, #1a2a6c, #0f1b4c); color: #fff; cursor: pointer;
  z-index: 4; display: none; white-space: nowrap; text-align: center; box-sizing: border-box;
  font-family: 'Playfair Display', serif;
}
#probBtn { 
  position: fixed; 
  bottom:20px; right:20px; padding:10px 15px; 
  font-size:16px; 
  font-family: 'Playfair Display', serif;
  border:none; border-radius:8px; background: linear-gradient(145deg, #0f1b4c, #1a2a6c); color:#fff; cursor:pointer; display:none; z-index:4; }
#history { display:none; position: fixed; bottom:20px; left:20px; font-size:16px; background:#fff; color:#0f1b4c; padding:5px 10px; border-radius:8px; max-width:250px; z-index:99999; text-align:center; word-break:break-word; }
#probPopup { position: fixed; bottom: -500px; left:50%; transform:translateX(-50%); width:280px; max-height:400px; overflow-y:auto; background:#0f1b4c; color:#fff; font-size:16px; padding:15px; z-index:999999; text-align:left; border-radius:16px; border:2px solid silver; box-shadow:0 8px 20px rgba(0,0,0,0.3); transition:bottom 0.4s ease; }
#probPopup.open { bottom: 80px; }
#probPopup .probLine { display:flex; justify-content:space-between; padding:6px 10px; margin:5px 0; background:rgba(255,255,255,0.05); border-radius:6px; font-weight:bold; }
#roulette { position: fixed; bottom:30%; left:50%; transform:translateX(-50%); width:90%; max-width:200px; height:70px; display:none; align-items:center; justify-content:center; z-index:99998; border-radius:30px; overflow:hidden; background:#fefefe; border:3px solid #0f1b4c; }
#rouletteInner { display:flex; white-space:nowrap; font-size:28px; font-weight:bold; will-change: transform; }
.fortune { min-width:130px; height:60px; margin:0 5px; color:#0f1b4c; font-size:22px; display:flex; align-items:center; justify-content:center; }
#resultDisplay { 
  position:fixed; 
  top:50%; 
  left:50%; 
  transform:translate(-50%,-50%) translateY(40px);
  font-size:60px; font-weight:bold; text-align:center; display:none; 
  z-index:99999; color:#ff4500; text-shadow:2px 2px 10px rgba(0,0,0,0.3); 
}
#resetModal { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(255,255,255,0.95); border-radius:16px; padding:20px 25px; box-shadow:0 8px 20px rgba(0,0,0,0.3); text-align:center; z-index:1000000; font-family:'Playfair Display', serif; }
#resetModal p { font-size:18px; margin-bottom:20px; }
#resetModal button { margin:0 10px; padding:8px 20px; border:none; border-radius:10px; font-size:16px; cursor:pointer; }
#modalYes { background:#1a2a6c; color:#fff; }
#modalNo { background:#ccc; color:#000; }
#broom { position:absolute; font-size:30px; display:none; z-index:99999; pointer-events:none; }
#hintBtn { position:fixed; top:10px; right:10px; font-size:28px; z-index:999999; cursor:pointer; display:none; }
#hintPopup { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); width:300px; background:#ffffff; color:#0f1b4c; border-radius:16px; padding:20px; box-shadow:0 0 20px rgba(0,0,0,0.6); text-align:left; font-weight:bold; z-index:1000000; font-family:'Playfair Display', serif; }
#hintPopup p { margin:8px 0; }
</style>
</head>
<body>

<canvas id="particles"></canvas>

<div class="container">
  <div id="msg1" class="message">はじめまして</div>
  <div id="dataLine" class="message">Data Line</div>
  <div id="name">前田だよ</div>
  <div class="image-wrapper">
    <img id="imgA" class="image" src="A.png" alt="画像A">
    <img id="imgB" class="image" src="B.png" alt="画像B">
  </div>
</div>

<div id="roulette"><div id="rouletteInner"></div></div>
<div id="resultDisplay"></div>
<div id="history"></div>

<button id="omikujiBtn">おみくじを引く ✨</button>
<button id="probBtn">確率詳細</button>

<div id="probPopup"></div>

<div id="resetModal">
  <p>おみくじ履歴をリセットしますか？</p>
  <button id="modalYes">Yes</button>
  <button id="modalNo">No</button>
</div>

<div id="broom">🧹</div>
<div id="hintBtn">🔔</div>
<div id="hintPopup">
  <p>ある機能が隠れてるよ</p>
  <p>色々操作して探してね</p>
  <br>
  <p>①おみくじを引く</p>
  <p>②確率詳細ボタン</p>
  <p>③背景色変更</p>
  <p>④おみくじ履歴リセット</p>
</div>

<script>
// --- 粒子 ---
const canvas=document.getElementById("particles");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth; canvas.height=window.innerHeight;
const particleChars="MAEDA";
let particles=[];
for(let i=0;i<100;i++){
  particles.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*2+1,dx:(Math.random()-0.5)*1.2,dy:(Math.random()-0.5)*1.2,char:particleChars[Math.floor(Math.random()*particleChars.length)]});
}
function drawParticles(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="rgba(80,80,80,0.8)";
  particles.forEach(p=>{
    ctx.font=`${p.r*6}px sans-serif`;
    ctx.fillText(p.char,p.x,p.y);
    p.x+=p.dx; p.y+=p.dy;
    if(p.x<0||p.x>canvas.width)p.dx*=-1;
    if(p.y<0||p.y>canvas.height)p.dy*=-1;
  });
  requestAnimationFrame(drawParticles);
}
drawParticles();
window.addEventListener("resize",()=>{canvas.width=window.innerWidth; canvas.height=window.innerHeight;});

// --- フェードイン ---
function fadeIn(el,delay){ setTimeout(()=>{el.style.opacity=1;}, delay);}
fadeIn(document.getElementById("msg1"),500);
const dataLine=document.getElementById("dataLine");
dataLine.innerHTML=dataLine.textContent.split('').map((c,i)=>`<span style="animation-delay:${i*0.2}s">${c}</span>`).join('');
fadeIn(dataLine,2000);
fadeIn(document.getElementById("imgA"),5000);

// --- 画像切替 ---
setTimeout(()=>{
  const imgA=document.getElementById("imgA");
  const imgB=document.getElementById("imgB");
  const name=document.getElementById("name");
  imgA.style.zIndex=2; imgB.style.zIndex=1;
  imgA.style.opacity=1; imgB.style.opacity=0; name.style.opacity=1;
  let showA=true;
  setInterval(()=>{ showA=!showA; if(showA){ imgA.style.zIndex=2; imgB.style.zIndex=1; imgA.style.opacity=1; imgB.style.opacity=0; } else{ imgB.style.zIndex=2; imgA.style.zIndex=1; imgB.style.opacity=1; imgA.style.opacity=0; } },2000);

  document.getElementById("omikujiBtn").style.display="inline-block";
  document.getElementById("probBtn").style.display="inline-block";
  document.getElementById("hintBtn").style.display="block";
},8000);

// --- 💘 一瞬表示 ---
let heartTimeout = null;
const heartEl = document.createElement('div');
heartEl.textContent = '💘';
heartEl.style.position = 'absolute';
heartEl.style.fontSize = '20px';
heartEl.style.zIndex = 99999;
heartEl.style.pointerEvents = 'none';
heartEl.style.display = 'none';
document.body.appendChild(heartEl);

function showHeart(beta){
  if(beta <= 50) return; // 手前に傾けた角度が50度以上
  const imgA = document.getElementById("imgA");
  const imgB = document.getElementById("imgB");
  const img = imgA.style.opacity==1 ? imgA : imgB;
  const rect = img.getBoundingClientRect();
  if(heartTimeout) clearTimeout(heartTimeout);
  heartEl.style.left = `${rect.left + rect.width/2 - 10}px`;
  heartEl.style.top = `${rect.top + 35}px`;
  heartEl.style.display = 'block';
  heartTimeout = setTimeout(()=>{ heartEl.style.display='none'; heartTimeout = null; }, 300);
}

// --- 傾き ---
let targetX=0,targetY=0,currentX=0,currentY=0;
window.addEventListener('deviceorientation', (e)=>{ 
  targetY=e.gamma/2; 
  targetX=e.beta/3; 
  showHeart(e.beta); // 💘 表示
});
function animateTilt(){ currentY+=(targetY-currentY)*0.15; currentX+=(targetX-currentX)*0.15; document.querySelector('.container').style.transform=`rotateX(${currentX}deg) rotateY(${currentY}deg)`; requestAnimationFrame(animateTilt);}
animateTilt();

// --- 以下、おみくじ・確率・背景色・シェイク・長押し・ヒント など前回のコードと同じ ---
</script>
</body>
</html>
